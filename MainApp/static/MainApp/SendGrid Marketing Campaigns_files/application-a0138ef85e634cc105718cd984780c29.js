(function(){}).call(this),"undefined"!=typeof module&&module.exports&&(this["encoding-indexes"]=require("./encoding-indexes.js")["encoding-indexes"]),function(e){"use strict";function t(e,t,n){return e>=t&&n>=e}function n(e,t){return Math.floor(e/t)}function i(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function r(e){for(var t=String(e),n=t.length,i=0,r=[];n>i;){var o=t.charCodeAt(i);if(55296>o||o>57343)r.push(o);else if(o>=56320&&57343>=o)r.push(65533);else if(o>=55296&&56319>=o)if(i===n-1)r.push(65533);else{var s=e.charCodeAt(i+1);if(s>=56320&&57343>=s){var a=1023&o,u=1023&s;r.push(65536+(a<<10)+u),i+=1}else r.push(65533)}i+=1}return r}function o(e){for(var t="",n=0;n<e.length;++n){var i=e[n];65535>=i?t+=String.fromCharCode(i):(i-=65536,t+=String.fromCharCode((i>>10)+55296,(1023&i)+56320))}return t}function s(e){this.tokens=[].slice.call(e)}function a(e,t){if(e)throw TypeError("Decoder error");return t||65533}function u(e){throw TypeError("The code point "+e+" could not be encoded.")}function l(){}function c(){}function d(e){return e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(U,e)?U[e]:null}function h(e,t){return t?t[e]||null:null}function f(e,t){var n=t.indexOf(e);return-1===n?null:n}function p(t){if(!("encoding-indexes"in e))throw Error("Indexes missing. Did you forget to include encoding-indexes.js?");return e["encoding-indexes"][t]}function m(e){if(e>39419&&189e3>e||e>1237575)return null;var t,n=0,i=0,r=p("gb18030");for(t=0;t<r.length;++t){var o=r[t];if(!(o[0]<=e))break;n=o[0],i=o[1]}return i+e-n}function g(e){var t,n=0,i=0,r=p("gb18030");for(t=0;t<r.length;++t){var o=r[t];if(!(o[1]<=e))break;n=o[1],i=o[0]}return i+e-n}function v(e){var n=f(e,p("jis0208"));return null===n||t(n,8272,8835)?null:n}function y(e,t){if(!(this instanceof y))return new y(e,t);if(e=void 0!==e?String(e):V,t=i(t),this._encoding=d(e),null===this._encoding||"replacement"===this._encoding.name)throw RangeError("Unknown encoding: "+e);if(!W[this._encoding.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js?");return this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(t.fatal),this._ignoreBOM=Boolean(t.ignoreBOM),Object.defineProperty?(Object.defineProperty(this,"encoding",{value:this._encoding.name}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})):(this.encoding=this._encoding.name,this.fatal=this._fatal,this.ignoreBOM=this._ignoreBOM),this}function b(e,t){if(!(this instanceof b))return new b(e,t);if(e=void 0!==e?String(e):V,t=i(t),this._encoding=d(e),null===this._encoding||"replacement"===this._encoding.name)throw RangeError("Unknown encoding: "+e);var n=Boolean(t.NONSTANDARD_allowLegacyEncoding),r="utf-8"!==this._encoding.name&&"utf-16le"!==this._encoding.name&&"utf-16be"!==this._encoding.name;if(null===this._encoding||r&&!n)throw RangeError("Unknown encoding: "+e);if(!Q[this._encoding.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");return this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(t.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{value:this._encoding.name}):this.encoding=this._encoding.name,this}function w(e){var n=e.fatal,i=0,r=0,o=0,s=128,u=191;this.handler=function(e,l){if(l===L&&0!==o)return o=0,a(n);if(l===L)return z;if(0===o){if(t(l,0,127))return l;if(t(l,194,223))o=1,i=l-192;else if(t(l,224,239))224===l&&(s=160),237===l&&(u=159),o=2,i=l-224;else{if(!t(l,240,244))return a(n);240===l&&(s=144),244===l&&(u=143),o=3,i=l-240}return i<<=6*o,null}if(!t(l,s,u))return i=o=r=0,s=128,u=191,e.prepend(l),a(n);if(s=128,u=191,r+=1,i+=l-128<<6*(o-r),r!==o)return null;var c=i;return i=o=r=0,c}}function _(e){e.fatal;this.handler=function(e,n){if(n===L)return z;if(t(n,0,127))return n;var i,r;t(n,128,2047)?(i=1,r=192):t(n,2048,65535)?(i=2,r=224):t(n,65536,1114111)&&(i=3,r=240);for(var o=[(n>>6*i)+r];i>0;){var s=n>>6*(i-1);o.push(128|63&s),i-=1}return o}}function $(e,n){var i=n.fatal;this.handler=function(n,r){if(r===L)return z;if(t(r,0,127))return r;var o=e[r-128];return null===o?a(i):o}}function k(e,n){n.fatal;this.handler=function(n,i){if(i===L)return z;if(t(i,0,127))return i;var r=f(i,e);return null===r&&u(i),r+128}}function x(e){var n=e.fatal,i=0,r=0,o=0;this.handler=function(e,s){if(s===L&&0===i&&0===r&&0===o)return z;s!==L||0===i&&0===r&&0===o||(i=0,r=0,o=0,a(n));var u;if(0!==o){u=null,t(s,48,57)&&(u=m(10*(126*(10*(i-129)+(r-48))+(o-129))+s-48));var l=[r,o,s];return i=0,r=0,o=0,null===u?(e.prepend(l),a(n)):u}if(0!==r)return t(s,129,254)?(o=s,null):(e.prepend([r,s]),i=0,r=0,a(n));if(0!==i){if(t(s,48,57))return r=s,null;var c=i,d=null;i=0;var f=127>s?64:65;return(t(s,64,126)||t(s,128,254))&&(d=190*(c-129)+(s-f)),u=null===d?null:h(d,p("gb18030")),null===d&&e.prepend(s),null===u?a(n):u}return t(s,0,127)?s:128===s?8364:t(s,129,254)?(i=s,null):a(n)}}function C(e,i){e.fatal;this.handler=function(e,r){if(r===L)return z;if(t(r,0,127))return r;if(i&&8364===r)return 128;var o=f(r,p("gb18030"));if(null!==o){var s=n(o,190)+129,a=o%190,l=63>a?64:65;return[s,a+l]}if(i)return u(r);o=g(r);var c=n(n(n(o,10),126),10);o-=10*c*126*10;var d=n(n(o,10),126);o-=10*d*126;var h=n(o,10),m=o-10*h;return[c+129,d+48,h+129,m+48]}}function F(e){var n=e.fatal,i=0;this.handler=function(e,r){if(r===L&&0!==i)return i=0,a(n);if(r===L&&0===i)return z;if(0!==i){var o=i,s=null;i=0;var u=127>r?64:98;switch((t(r,64,126)||t(r,161,254))&&(s=157*(o-129)+(r-u)),s){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}var l=null===s?null:h(s,p("big5"));return null===s&&e.prepend(r),null===l?a(n):l}return t(r,0,127)?r:t(r,129,254)?(i=r,null):a(n)}}function S(e){e.fatal;this.handler=function(e,i){if(i===L)return z;if(t(i,0,127))return i;var r=f(i,p("big5"));if(null===r)return u(i);var o=n(r,157)+129;if(161>o)return u(i);var s=r%157,a=63>s?64:98;return[o,s+a]}}function E(e){var n=e.fatal,i=!1,r=0;this.handler=function(e,o){if(o===L&&0!==r)return r=0,a(n);if(o===L&&0===r)return z;if(142===r&&t(o,161,223))return r=0,65377+o-161;if(143===r&&t(o,161,254))return i=!0,r=o,null;if(0!==r){var s=r;r=0;var u=null;return t(s,161,254)&&t(o,161,254)&&(u=h(94*(s-161)+(o-161),p(i?"jis0212":"jis0208"))),i=!1,t(o,161,254)||e.prepend(o),null===u?a(n):u}return t(o,0,127)?o:142===o||143===o||t(o,161,254)?(r=o,null):a(n)}}function T(e){e.fatal;this.handler=function(e,i){if(i===L)return z;if(t(i,0,127))return i;if(165===i)return 92;if(8254===i)return 126;if(t(i,65377,65439))return[142,i-65377+161];var r=f(i,p("jis0208"));if(null===r)return u(i);var o=n(r,94)+161,s=r%94+161;return[o,s]}}function j(e){var n=e.fatal,i={ASCII:0,Roman:1,Katakana:2,LeadByte:3,TrailByte:4,EscapeStart:5,Escape:6},r=i.ASCII,o=i.ASCII,s=0,u=!1;this.handler=function(e,l){switch(r){default:case i.ASCII:return 27===l?(r=i.EscapeStart,null):t(l,0,127)&&14!==l&&15!==l&&27!==l?(u=!1,l):l===L?z:(u=!1,a(n));case i.Roman:return 27===l?(r=i.EscapeStart,null):92===l?(u=!1,165):126===l?(u=!1,8254):t(l,0,127)&&14!==l&&15!==l&&27!==l&&92!==l&&126!==l?(u=!1,l):l===L?z:(u=!1,a(n));case i.Katakana:return 27===l?(r=i.EscapeStart,null):t(l,33,95)?(u=!1,65377+l-33):l===L?z:(u=!1,a(n));case i.LeadByte:return 27===l?(r=i.EscapeStart,null):t(l,33,126)?(u=!1,s=l,r=i.TrailByte,null):l===L?z:(u=!1,a(n));case i.TrailByte:if(27===l)return r=i.EscapeStart,a(n);if(t(l,33,126)){r=i.LeadByte;var c=94*(s-33)+l-33,d=h(c,p("jis0208"));return null===d?a(n):d}return l===L?(r=i.LeadByte,e.prepend(l),a(n)):(r=i.LeadByte,a(n));case i.EscapeStart:return 36===l||40===l?(s=l,r=i.Escape,null):(e.prepend(l),u=!1,r=o,a(n));case i.Escape:var f=s;s=0;var m=null;if(40===f&&66===l&&(m=i.ASCII),40===f&&74===l&&(m=i.Roman),40===f&&73===l&&(m=i.Katakana),36!==f||64!==l&&66!==l||(m=i.LeadByte),null!==m){r=r=m;var g=u;return u=!0,g?a(n):null}return e.prepend([f,l]),u=!1,r=o,a(n)}}}function O(e){var i=(e.fatal,{ASCII:0,Roman:1,jis0208:2}),r=i.ASCII;this.handler=function(e,o){if(o===L&&r!==i.ASCII)return e.prepend(o),[27,40,66];if(o===L&&r===i.ASCII)return z;if(r===i.ASCII&&t(o,0,127))return o;if(r===i.Roman&&t(o,0,127)&&92!==o&&126!==o){if(t(o,0,127))return o;if(165===o)return 92;if(8254===o)return 126}if(t(o,0,127)&&r!==i.ASCII)return e.prepend(o),r=i.ASCII,[27,40,66];if((165===o||8254===o)&&r!==i.Roman)return e.prepend(o),r=i.Roman,[27,40,74];var s=f(o,p("jis0208"));if(null===s)return u(o);if(r!==i.jis0208)return e.prepend(o),r=i.jis0208,[27,36,66];var a=n(s,94)+33,l=s%94+33;return[a,l]}}function N(e){var n=e.fatal,i=0;this.handler=function(e,r){if(r===L&&0!==i)return i=0,a(n);if(r===L&&0===i)return z;if(0!==i){var o=i,s=null;i=0;var u=127>r?64:65,l=160>o?129:193;(t(r,64,126)||t(r,128,252))&&(s=188*(o-l)+r-u);var c=null===s?null:h(s,p("jis0208"));return null===c&&null!==s&&t(s,8836,10528)?57344+s-8836:(null===s&&e.prepend(r),null===c?a(n):c)}return t(r,0,128)?r:t(r,161,223)?65377+r-161:t(r,129,159)||t(r,224,252)?(i=r,null):a(n)}}function A(e){e.fatal;this.handler=function(e,i){if(i===L)return z;if(t(i,0,128))return i;if(165===i)return 92;if(8254===i)return 126;if(t(i,65377,65439))return i-65377+161;var r=v(i);if(null===r)return u(i);var o=n(r,188),s=31>o?129:193,a=r%188,l=63>a?64:65;return[o+s,a+l]}}function M(e){var n=e.fatal,i=0;this.handler=function(e,r){if(r===L&&0!==i)return i=0,a(n);if(r===L&&0===i)return z;if(0!==i){var o=i,s=null;i=0,t(r,65,254)&&(s=190*(o-129)+(r-65));var u=null===s?null:h(s,p("euc-kr"));return null===s&&t(r,0,127)&&e.prepend(r),null===u?a(n):u}return t(r,0,127)?r:t(r,129,254)?(i=r,null):a(n)}}function R(e){e.fatal;this.handler=function(e,i){if(i===L)return z;if(t(i,0,127))return i;var r=f(i,p("euc-kr"));if(null===r)return u(i);var o=n(r,190)+129,s=r%190+65;return[o,s]}}function B(e,t){var n=e>>8,i=255&e;return t?[n,i]:[i,n]}function P(e,n){var i=n.fatal,r=null,o=null;this.handler=function(n,s){if(s===L&&(null!==r||null!==o))return a(i);if(s===L&&null===r&&null===o)return z;if(null===r)return r=s,null;var u;if(u=e?(r<<8)+s:(s<<8)+r,r=null,null!==o){var l=o;return o=null,t(u,56320,57343)?65536+1024*(l-55296)+(u-56320):(n.prepend(B(u,e)),a(i))}return t(u,55296,56319)?(o=u,null):t(u,56320,57343)?a(i):u}}function q(e,n){n.fatal;this.handler=function(n,i){if(i===L)return z;if(t(i,0,65535))return B(i,e);var r=B((i-65536>>10)+55296,e),o=B((i-65536&1023)+56320,e);return r.concat(o)}}function D(e){e.fatal;this.handler=function(e,n){return n===L?z:t(n,0,127)?n:63360+n-128}}function I(e){e.fatal;this.handler=function(e,n){return n===L?z:t(n,0,127)?n:t(n,63360,63487)?n-63360+128:u(n)}}var L=-1;s.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():L},prepend:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.unshift(t.pop());else this.tokens.unshift(e)},push:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.push(t.shift());else this.tokens.push(e)}};var z=-1;l.prototype={handler:function(){}},c.prototype={handler:function(){}};var H=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],name:"iso-8859-5"},{labels:["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],name:"iso-8859-7"},{labels:["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],name:"iso-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"iso-8859-8-i"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"iso-8859-14"},{labels:["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],name:"windows-1252"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"utf-16be"},{labels:["utf-16","utf-16le"],name:"utf-16le"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],U={};H.forEach(function(e){e.encodings.forEach(function(e){e.labels.forEach(function(t){U[t]=e})})});var Q={},W={},V="utf-8";y.prototype={decode:function(e,t){var n;n="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t=i(t),this._streaming||(this._decoder=W[this._encoding.name]({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(t.stream);for(var r,a=new s(n),u=[];!a.endOfStream()&&(r=this._decoder.handler(a,a.read()),r!==z);)null!==r&&(Array.isArray(r)?u.push.apply(u,r):u.push(r));if(!this._streaming){do{if(r=this._decoder.handler(a,a.read()),r===z)break;null!==r&&(Array.isArray(r)?u.push.apply(u,r):u.push(r))}while(!a.endOfStream());this._decoder=null}return u.length&&(-1===["utf-8","utf-16le","utf-16be"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===u[0]?(this._BOMseen=!0,u.shift()):this._BOMseen=!0)),o(u)}},b.prototype={encode:function(e,t){e=e?String(e):"",t=i(t),this._streaming||(this._encoder=Q[this._encoding.name](this._options)),this._streaming=Boolean(t.stream);for(var n,o=[],a=new s(r(e));!a.endOfStream()&&(n=this._encoder.handler(a,a.read()),n!==z);)Array.isArray(n)?o.push.apply(o,n):o.push(n);if(!this._streaming){for(;;){if(n=this._encoder.handler(a,a.read()),n===z)break;Array.isArray(n)?o.push.apply(o,n):o.push(n)}this._encoder=null}return new Uint8Array(o)}},Q["utf-8"]=function(e){return new _(e)},W["utf-8"]=function(e){return new w(e)},function(){"encoding-indexes"in e&&H.forEach(function(e){"Legacy single-byte encodings"===e.heading&&e.encodings.forEach(function(e){var t=e.name,n=p(t);W[t]=function(e){return new $(n,e)},Q[t]=function(e){return new k(n,e)}})})}(),W.gbk=function(e){return new x(e)},Q.gbk=function(e){return new C(e,!0)},Q.gb18030=function(e){return new C(e)},W.gb18030=function(e){return new x(e)},Q.big5=function(e){return new S(e)},W.big5=function(e){return new F(e)},Q["euc-jp"]=function(e){return new T(e)},W["euc-jp"]=function(e){return new E(e)},Q["iso-2022-jp"]=function(e){return new O(e)},W["iso-2022-jp"]=function(e){return new j(e)},Q.shift_jis=function(e){return new A(e)},W.shift_jis=function(e){return new N(e)},Q["euc-kr"]=function(e){return new R(e)},W["euc-kr"]=function(e){return new M(e)},Q["utf-16be"]=function(e){return new q(!0,e)},W["utf-16be"]=function(e){return new P(!0,e)},Q["utf-16le"]=function(e){return new q(!1,e)},W["utf-16le"]=function(e){return new P(!1,e)},Q["x-user-defined"]=function(e){return new I(e)},W["x-user-defined"]=function(e){return new D(e)},"TextEncoder"in e||(e.TextEncoder=b),"TextDecoder"in e||(e.TextDecoder=y)}(this),!function(e){"use strict";function t(t,n){if(n=n||{},n.worker&&Papa.WORKERS_SUPPORTED){var i=c();return i.userStep=n.step,i.userChunk=n.chunk,i.userComplete=n.complete,i.userError=n.error,n.step=v(n.step),n.chunk=v(n.chunk),n.complete=v(n.complete),n.error=v(n.error),delete n.worker,void i.postMessage({input:t,config:n,workerId:i.id})}var a=null;return"string"==typeof t?a=n.download?new r(n):new s(n):(e.File&&t instanceof File||t instanceof Object)&&(a=new o(n)),a.stream(t)}function n(t,n){function i(){"object"==typeof n&&("string"==typeof n.delimiter&&1==n.delimiter.length&&-1==e.Papa.BAD_DELIMITERS.indexOf(n.delimiter)&&(l=n.delimiter),("boolean"==typeof n.quotes||n.quotes instanceof Array)&&(u=n.quotes),"string"==typeof n.newline&&(c=n.newline))}function r(e){if("object"!=typeof e)return[];var t=[];for(var n in e)t.push(n);return t}function o(e,t){var n="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var i=e instanceof Array&&e.length>0,r=!(t[0]instanceof Array);if(i){for(var o=0;o<e.length;o++)o>0&&(n+=l),n+=s(e[o],o);t.length>0&&(n+=c)}for(var a=0;a<t.length;a++){for(var u=i?e.length:t[a].length,d=0;u>d;d++){d>0&&(n+=l);var h=i&&r?e[d]:d;n+=s(t[a][h],d)}a<t.length-1&&(n+=c)}return n}function s(t,n){if("undefined"==typeof t||null===t)return"";t=t.toString().replace(/"/g,'""');var i="boolean"==typeof u&&u||u instanceof Array&&u[n]||a(t,e.Papa.BAD_DELIMITERS)||t.indexOf(l)>-1||" "==t.charAt(0)||" "==t.charAt(t.length-1);return i?'"'+t+'"':t}function a(e,t){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return!0;return!1}var u=!1,l=",",c="\r\n";if(i(),"string"==typeof t&&(t=JSON.parse(t)),t instanceof Array){if(!t.length||t[0]instanceof Array)return o(null,t);if("object"==typeof t[0])return o(r(t[0]),t)}else if("object"==typeof t)return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),t.data instanceof Array&&(t.fields||(t.fields=t.data[0]instanceof Array?t.fields:r(t.data[0])),t.data[0]instanceof Array||"object"==typeof t.data[0]||(t.data=[t.data])),o(t.fields||[],t.data||[]);throw"exception: Unable to serialize unrecognized input"}function i(t){function n(e){var t=m(e);t.chunkSize=parseInt(t.chunkSize),this._handle=new a(t),this._handle.streamer=this,this._config=t}this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,n.call(this,t),this.parseChunk=function(t){var n=this._partialLine+t;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()){var r=i.meta.cursor;this._finished||(this._partialLine=n.substring(r-this._baseIndex),this._baseIndex=r),i&&i.data&&(this._rowCount+=i.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(b)e.postMessage({results:i,workerId:Papa.WORKER_ID,finished:o});else if(v(this._config.chunk)){if(this._config.chunk(i,this._handle),this._paused)return;i=void 0}return!o||!v(this._config.complete)||i&&i.meta.aborted||this._config.complete(i),o||i&&i.meta.paused||this._nextChunk(),i}},this._sendError=function(t){v(this._config.error)?this._config.error(t):b&&this._config.error&&e.postMessage({workerId:Papa.WORKER_ID,error:t,finished:!1})}}function r(e){function t(e){var t=e.getResponseHeader("Content-Range");return parseInt(t.substr(t.lastIndexOf("/")+1))}e=e||{},e.chunkSize||(e.chunkSize=Papa.RemoteChunkSize),i.call(this,e);var n;this._nextChunk=b?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)return void this._chunkLoaded();if(n=new XMLHttpRequest,b||(n.onload=g(this._chunkLoaded,this),n.onerror=g(this._chunkError,this)),n.open("GET",this._input,!b),this._config.step||this._config.chunk){var e=this._start+this._config.chunkSize-1;n.setRequestHeader("Range","bytes="+this._start+"-"+e),n.setRequestHeader("If-None-Match","webkit-no-cache")}try{n.send()}catch(t){this._chunkError(t.message)}b&&0==n.status?this._chunkError():this._start+=this._config.chunkSize},this._chunkLoaded=function(){if(4==n.readyState){if(n.status<200||n.status>=400)return void this._chunkError();this._finished=!this._config.step&&!this._config.chunk||this._start>t(n),this.parseChunk(n.responseText)}},this._chunkError=function(e){var t=n.statusText||e;this._sendError(t)}}function o(e){e=e||{},e.chunkSize||(e.chunkSize=Papa.LocalChunkSize),i.call(this,e);var t,n,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?(t=new FileReader,t.onload=g(this._chunkLoaded,this),t.onerror=g(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=Math.min(this._start+this._config.chunkSize,this._input.size),i=t.readAsText(n.call(this._input,this._start,e),this._config.encoding);r||this._chunkLoaded({target:{result:i}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function s(e){e=e||{},i.call(this,e);var t,n;this.stream=function(e){return t=e,n=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,t=e?n.substr(0,e):n;return n=e?n.substr(e):"",this._finished=!n,this.parseChunk(t)}}}function a(e){function t(){if(w&&h&&(l("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Papa.DefaultDelimiter+"'"),h=!1),e.skipEmptyLines)for(var t=0;t<w.data.length;t++)1==w.data[t].length&&""==w.data[t][0]&&w.data.splice(t--,1);return n()&&i(),r()}function n(){return e.header&&0==b.length}function i(){if(w){for(var e=0;n()&&e<w.data.length;e++)for(var t=0;t<w.data[e].length;t++)b.push(w.data[e][t]);w.data.splice(0,1)}}function r(){if(!w||!e.header&&!e.dynamicTyping)return w;for(var t=0;t<w.data.length;t++){for(var n={},i=0;i<w.data[t].length;i++){if(e.dynamicTyping){var r=w.data[t][i];w.data[t][i]="true"==r?!0:"false"==r?!1:a(r)}e.header&&(i>=b.length?(n.__parsed_extra||(n.__parsed_extra=[]),n.__parsed_extra.push(w.data[t][i])):n[b[i]]=w.data[t][i])}e.header&&(w.data[t]=n,i>b.length?l("FieldMismatch","TooManyFields","Too many fields: expected "+b.length+" fields but parsed "+i,t):i<b.length&&l("FieldMismatch","TooFewFields","Too few fields: expected "+b.length+" fields but parsed "+i,t))}return e.header&&w.meta&&(w.meta.fields=b),w}function o(t){for(var n,i,r,o=[",","	","|",";",Papa.RECORD_SEP,Papa.UNIT_SEP],s=0;s<o.length;s++){var a=o[s],l=0,c=0;r=void 0;for(var d=new u({delimiter:a,preview:10}).parse(t),h=0;h<d.data.length;h++){var f=d.data[h].length;c+=f,"undefined"!=typeof r?f>1&&(l+=Math.abs(f-r),r=f):r=f}c/=d.data.length,("undefined"==typeof i||i>l)&&c>1.99&&(i=l,n=a)}return e.delimiter=n,{successful:!!n,bestDelimiter:n}}function s(e){e=e.substr(0,1048576);var t=e.split("\r");if(1==t.length)return"\n";for(var n=0,i=0;i<t.length;i++)"\n"==t[i][0]&&n++;return n>=t.length/2?"\r\n":"\r"}function a(e){var t=f.test(e);return t?parseFloat(e):e}function l(e,t,n,i){w.errors.push({type:e,code:t,message:n,row:i})}var c,d,h,f=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,p=this,g=0,y=!1,b=[],w={data:[],errors:[],meta:{}};if(v(e.step)){var _=e.step;e.step=function(i){if(w=i,n())t();else{if(t(),0==w.data.length)return;g+=i.data.length,e.preview&&g>e.preview?d.abort():_(w,p)}}}this.parse=function(n,i,r){if(e.newline||(e.newline=s(n)),h=!1,!e.delimiter){var a=o(n);a.successful?e.delimiter=a.bestDelimiter:(h=!0,e.delimiter=Papa.DefaultDelimiter),w.meta.delimiter=e.delimiter}var l=m(e);return e.preview&&e.header&&l.preview++,c=n,d=new u(l),w=d.parse(c,i,r),t(),y?{meta:{paused:!0}}:w||{meta:{paused:!1}}},this.paused=function(){return y},this.pause=function(){y=!0,d.abort(),c=c.substr(d.getCharIndex())},this.resume=function(){y=!1,p.streamer.parseChunk(c)},this.abort=function(){d.abort(),v(e.complete)&&e.complete(w),c=""}}function u(e){e=e||{};var t=e.delimiter,n=e.newline,i=e.comments,r=e.step,o=e.preview,s=e.fastMode;if(("string"!=typeof t||1!=t.length||Papa.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),i===t)throw"Comment character same as delimiter";i===!0?i="#":("string"!=typeof i||Papa.BAD_DELIMITERS.indexOf(i)>-1)&&(i=!1),"\n"!=n&&"\r"!=n&&"\r\n"!=n&&(n="\n");var a=0,u=!1;this.parse=function(e,l,c){function d(e){_.push(e),x=a}function h(t){return c?p():(t||(t=e.substr(a)),k.push(t),a=g,d(k),w&&m(),p())}function f(t){a=t,d(k),k=[],E=e.indexOf(n,a)}function p(e){return{data:_,errors:$,meta:{delimiter:t,linebreak:n,aborted:u,truncated:!!e,cursor:x+(l||0)}}}function m(){r(p()),_=[],$=[]}if("string"!=typeof e)throw"Input must be a string";var g=e.length,v=t.length,y=n.length,b=i.length,w="function"==typeof r;a=0;var _=[],$=[],k=[],x=0;if(!e)return p();if(s||s!==!1&&-1===e.indexOf('"')){for(var C=e.split(n),F=0;F<C.length;F++){var k=C[F];if(a+=k.length,F!==C.length-1)a+=n.length;else if(c)return p();if(!i||k.substr(0,b)!=i){if(w){if(_=[],d(k.split(t)),m(),u)return p()}else d(k.split(t));if(o&&F>=o)return _=_.slice(0,o),p(!0)}}return p()}for(var S=e.indexOf(t,a),E=e.indexOf(n,a);;)if('"'!=e[a])if(i&&0===k.length&&e.substr(a,b)===i){if(-1==E)return p();a=E+y,E=e.indexOf(n,a),S=e.indexOf(t,a)}else if(-1!==S&&(E>S||-1===E))k.push(e.substring(a,S)),a=S+v,S=e.indexOf(t,a);else{if(-1===E)break;if(k.push(e.substring(a,E)),f(E+y),w&&(m(),u))return p();if(o&&_.length>=o)return p(!0)}else{var T=a;for(a++;;){var T=e.indexOf('"',T+1);if(-1===T)return c||$.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:a}),h();if(T===g-1){var j=e.substring(a,T).replace(/""/g,'"');return h(j)}if('"'!=e[T+1]){if(e[T+1]==t){k.push(e.substring(a,T).replace(/""/g,'"')),a=T+1+v,S=e.indexOf(t,a),E=e.indexOf(n,a);break}if(e.substr(T+1,y)===n){if(k.push(e.substring(a,T).replace(/""/g,'"')),f(T+1+y),S=e.indexOf(t,a),w&&(m(),u))return p();if(o&&_.length>=o)return p(!0);break}}else T++}}return h()},this.abort=function(){u=!0},this.getCharIndex=function(){return a}}function l(){var e=document.getElementsByTagName("script");return e.length?e[e.length-1].src:""}function c(){if(!Papa.WORKERS_SUPPORTED)return!1;if(!w&&null===Papa.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=new e.Worker(Papa.SCRIPT_PATH||y);return t.onmessage=d,t.id=$++,_[t.id]=t,t}function d(e){var t=e.data,n=_[t.workerId],i=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var r=function(){i=!0,h(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},o={abort:r,pause:f,resume:f};if(v(n.userStep)){for(var s=0;s<t.results.data.length&&(n.userStep({data:[t.results.data[s]],errors:t.results.errors,meta:t.results.meta},o),!i);s++);delete t.results}else v(n.userChunk)&&(n.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!i&&h(t.workerId,t.results)}function h(e,t){var n=_[e];v(n.userComplete)&&n.userComplete(t),n.terminate(),delete _[e]}function f(){throw"Not implemented."}function p(t){var n=t.data;if("undefined"==typeof Papa.WORKER_ID&&n&&(Papa.WORKER_ID=n.workerId),"string"==typeof n.input)e.postMessage({workerId:Papa.WORKER_ID,results:Papa.parse(n.input,n.config),finished:!0});else if(e.File&&n.input instanceof File||n.input instanceof Object){var i=Papa.parse(n.input,n.config);i&&e.postMessage({workerId:Papa.WORKER_ID,results:i,finished:!0})}}function m(e){if("object"!=typeof e)return e;var t=e instanceof Array?[]:{};for(var n in e)t[n]=m(e[n]);return t}function g(e,t){return function(){e.apply(t,arguments)}}function v(e){return"function"==typeof e}var y,b=!e.document,w=!1,_={},$=0;if(e.Papa={},e.Papa.parse=t,e.Papa.unparse=n,e.Papa.RECORD_SEP=String.fromCharCode(30),e.Papa.UNIT_SEP=String.fromCharCode(31),e.Papa.BYTE_ORDER_MARK="",e.Papa.BAD_DELIMITERS=["\r","\n",'"',e.Papa.BYTE_ORDER_MARK],e.Papa.WORKERS_SUPPORTED=!!e.Worker,e.Papa.SCRIPT_PATH=null,e.Papa.LocalChunkSize=10485760,e.Papa.RemoteChunkSize=5242880,e.Papa.DefaultDelimiter=",",e.Papa.Parser=u,e.Papa.ParserHandle=a,e.Papa.NetworkStreamer=r,e.Papa.FileStreamer=o,e.Papa.StringStreamer=s,e.jQuery){var k=e.jQuery;k.fn.parse=function(t){function n(){if(0==s.length)return void(v(t.complete)&&t.complete());var e=s[0];if(v(t.before)){var n=t.before(e.file,e.inputElem);if("object"==typeof n){if("abort"==n.action)return void i("AbortError",e.file,e.inputElem,n.reason);if("skip"==n.action)return void r();"object"==typeof n.config&&(e.instanceConfig=k.extend(e.instanceConfig,n.config))}else if("skip"==n)return void r()}var o=e.instanceConfig.complete;e.instanceConfig.complete=function(t){v(o)&&o(t,e.file,e.inputElem),r()},Papa.parse(e.file,e.instanceConfig)}function i(e,n,i,r){v(t.error)&&t.error({name:e},n,i,r)}function r(){s.splice(0,1),n()}var o=t.config||{},s=[];return this.each(function(){var t="INPUT"==k(this).prop("tagName").toUpperCase()&&"file"==k(this).attr("type").toLowerCase()&&e.FileReader;if(!t||!this.files||0==this.files.length)return!0;for(var n=0;n<this.files.length;n++)s.push({file:this.files[n],inputElem:this,instanceConfig:k.extend({},o)})}),n(),this}}b?e.onmessage=p:Papa.WORKERS_SUPPORTED&&(y=l(),document.body?document.addEventListener("DOMContentLoaded",function(){w=!0},!0):w=!0),r.prototype=Object.create(i.prototype),r.prototype.constructor=r,o.prototype=Object.create(i.prototype),o.prototype.constructor=o,s.prototype=Object.create(s.prototype),s.prototype.constructor=s}(this),window.Modernizr=function(e,t,n){function i(e){y.cssText=e}function r(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function s(e,t){for(var i in e){var r=e[i];if(!o(r,"-")&&y[r]!==n)return"pfx"==t?r:!0}return!1}function a(e,t,i){for(var o in e){var s=t[e[o]];if(s!==n)return i===!1?e[o]:r(s,"function")?s.bind(i||t):s}return!1}function u(e,t,n){var i=e.charAt(0).toUpperCase()+e.slice(1),o=(e+" "+k.join(i+" ")+i).split(" ");return r(t,"string")||r(t,"undefined")?s(o,t):(o=(e+" "+x.join(i+" ")+i).split(" "),a(o,t,n))}function l(){f.input=function(n){for(var i=0,r=n.length;r>i;i++)S[n[i]]=n[i]in b;return S.list&&(S.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),S}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),f.inputtypes=function(e){for(var i,r,o,s=0,a=e.length;a>s;s++)b.setAttribute("type",r=e[s]),i="text"!==b.type,i&&(b.value=w,b.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(r)&&b.style.WebkitAppearance!==n?(m.appendChild(b),o=t.defaultView,i=o.getComputedStyle&&"textfield"!==o.getComputedStyle(b,null).WebkitAppearance&&0!==b.offsetHeight,m.removeChild(b)):/^(search|tel)$/.test(r)||(i=/^(url|email)$/.test(r)?b.checkValidity&&b.checkValidity()===!1:b.value!=w)),F[e[s]]=!!i;
return F}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var c,d,h="2.8.3",f={},p=!0,m=t.documentElement,g="modernizr",v=t.createElement(g),y=v.style,b=t.createElement("input"),w=":)",_=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),$="Webkit Moz O ms",k=$.split(" "),x=$.toLowerCase().split(" "),C={},F={},S={},E=[],T=E.slice,j=function(e,n,i,r){var o,s,a,u,l=t.createElement("div"),c=t.body,d=c||t.createElement("body");if(parseInt(i,10))for(;i--;)a=t.createElement("div"),a.id=r?r[i]:g+(i+1),l.appendChild(a);return o=["&#173;",'<style id="s',g,'">',e,"</style>"].join(""),l.id=g,(c?l:d).innerHTML+=o,d.appendChild(l),c||(d.style.background="",d.style.overflow="hidden",u=m.style.overflow,m.style.overflow="hidden",m.appendChild(d)),s=n(l,e),c?l.parentNode.removeChild(l):(d.parentNode.removeChild(d),m.style.overflow=u),!!s},O=function(){function e(e,o){o=o||t.createElement(i[e]||"div"),e="on"+e;var s=e in o;return s||(o.setAttribute||(o=t.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(e,""),s=r(o[e],"function"),r(o[e],"undefined")||(o[e]=n),o.removeAttribute(e))),o=null,s}var i={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return e}(),N={}.hasOwnProperty;d=r(N,"undefined")||r(N.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(e,t){return N.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=T.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=t.prototype;var o=new r,s=t.apply(o,n.concat(T.call(arguments)));return Object(s)===s?s:o}return t.apply(e,n.concat(T.call(arguments)))};return i}),C.flexbox=function(){return u("flexWrap")},C.flexboxlegacy=function(){return u("boxDirection")},C.postmessage=function(){return!!e.postMessage},C.websqldatabase=function(){return!!e.openDatabase},C.indexedDB=function(){return!!u("indexedDB",e)},C.hashchange=function(){return O("hashchange",e)&&(t.documentMode===n||t.documentMode>7)},C.history=function(){return!!e.history&&!!history.pushState},C.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},C.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e},C.hsla=function(){return i("background-color:hsla(120,40%,100%,.5)"),o(y.backgroundColor,"rgba")||o(y.backgroundColor,"hsla")},C.multiplebgs=function(){return i("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(y.background)},C.cssanimations=function(){return u("animationName")},C.csscolumns=function(){return u("columnCount")},C.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return i((e+"-webkit- ".split(" ").join(t+e)+_.join(n+e)).slice(0,-e.length)),o(y.backgroundImage,"gradient")},C.cssreflections=function(){return u("boxReflect")},C.csstransforms=function(){return!!u("transform")},C.csstransforms3d=function(){var e=!!u("perspective");return e&&"webkitPerspective"in m.style&&j("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e},C.csstransitions=function(){return u("transition")},C.localstorage=function(){try{return localStorage.setItem(g,g),localStorage.removeItem(g),!0}catch(e){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(g,g),sessionStorage.removeItem(g),!0}catch(e){return!1}},C.webworkers=function(){return!!e.Worker},C.applicationcache=function(){return!!e.applicationCache};for(var A in C)d(C,A)&&(c=A.toLowerCase(),f[c]=C[A](),E.push((f[c]?"":"no-")+c));return f.input||l(),f.addTest=function(e,t){if("object"==typeof e)for(var i in e)d(e,i)&&f.addTest(i,e[i]);else{if(e=e.toLowerCase(),f[e]!==n)return f;t="function"==typeof t?t():t,"undefined"!=typeof p&&p&&(m.className+=" "+(t?"":"no-")+e),f[e]=t}return f},i(""),v=b=null,f._version=h,f._prefixes=_,f._domPrefixes=x,f._cssomPrefixes=k,f.hasEvent=O,f.testProp=function(e){return s([e])},f.testAllProps=u,f.testStyles=j,f.prefixed=function(e,t,n){return t?u(e,t,n):u(e,"pfx")},m.className=m.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+E.join(" "):""),f}(this,this.document),function(e,t,n){function i(e){return"[object Function]"==g.call(e)}function r(e){return"string"==typeof e}function o(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function a(){var e=v.shift();y=1,e?e.t?p(function(){("c"==e.t?h.injectCss:h.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),a()):y=0}function u(e,n,i,r,o,u,l){function c(t){if(!f&&s(d.readyState)&&(b.r=f=1,!y&&a(),d.onload=d.onreadystatechange=null,t)){"img"!=e&&p(function(){_.removeChild(d)},50);for(var i in F[n])F[n].hasOwnProperty(i)&&F[n][i].onload()}}var l=l||h.errorTimeout,d=t.createElement(e),f=0,g=0,b={t:i,s:n,e:o,a:u,x:l};1===F[n]&&(g=1,F[n]=[]),"object"==e?d.data=n:(d.src=n,d.type=e),d.width=d.height="0",d.onerror=d.onload=d.onreadystatechange=function(){c.call(this,g)},v.splice(r,0,b),"img"!=e&&(g||2===F[n]?(_.insertBefore(d,w?null:m),p(c,l)):F[n].push(d))}function l(e,t,n,i,o){return y=0,t=t||"j",r(e)?u("c"==t?k:$,e,t,this.i++,n,i,o):(v.splice(this.i++,0,e),1==v.length&&a()),this}function c(){var e=h;return e.loader={load:l,i:0},e}var d,h,f=t.documentElement,p=e.setTimeout,m=t.getElementsByTagName("script")[0],g={}.toString,v=[],y=0,b="MozAppearance"in f.style,w=b&&!!t.createRange().compareNode,_=w?f:m.parentNode,f=e.opera&&"[object Opera]"==g.call(e.opera),f=!!t.attachEvent&&!f,$=b?"object":f?"script":"img",k=f?"script":$,x=Array.isArray||function(e){return"[object Array]"==g.call(e)},C=[],F={},S={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};h=function(e){function t(e){var t,n,i,e=e.split("!"),r=C.length,o=e.pop(),s=e.length,o={url:o,origUrl:o,prefixes:e};for(n=0;s>n;n++)i=e[n].split("="),(t=S[i.shift()])&&(o=t(o,i));for(n=0;r>n;n++)o=C[n](o);return o}function s(e,r,o,s,a){var u=t(e),l=u.autoCallback;u.url.split(".").pop().split("?").shift(),u.bypass||(r&&(r=i(r)?r:r[e]||r[s]||r[e.split("/").pop().split("?")[0]]),u.instead?u.instead(e,r,o,s,a):(F[u.url]?u.noexec=!0:F[u.url]=1,o.load(u.url,u.forceCSS||!u.forceJS&&"css"==u.url.split(".").pop().split("?").shift()?"c":n,u.noexec,u.attrs,u.timeout),(i(r)||i(l))&&o.load(function(){c(),r&&r(u.origUrl,a,s),l&&l(u.origUrl,a,s),F[u.url]=2})))}function a(e,t){function n(e,n){if(e){if(r(e))n||(d=function(){var e=[].slice.call(arguments);h.apply(this,e),f()}),s(e,d,t,0,l);else if(Object(e)===e)for(u in a=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(u)&&(!n&&!--a&&(i(d)?d=function(){var e=[].slice.call(arguments);h.apply(this,e),f()}:d[u]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),f()}}(h[u])),s(e[u],d,t,u,l))}else!n&&f()}var a,u,l=!!e.test,c=e.load||e.both,d=e.callback||o,h=d,f=e.complete||o;n(l?e.yep:e.nope,!!c),c&&n(c)}var u,l,d=this.yepnope.loader;if(r(e))s(e,0,d,0);else if(x(e))for(u=0;u<e.length;u++)l=e[u],r(l)?s(l,0,d,0):x(l)?h(l):Object(l)===l&&a(l,d);else Object(e)===e&&a(e,d)},h.addPrefix=function(e,t){S[e]=t},h.addFilter=function(e){C.push(e)},h.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",d=function(){t.removeEventListener("DOMContentLoaded",d,0),t.readyState="complete"},0)),e.yepnope=c(),e.yepnope.executeStack=a,e.yepnope.injectJs=function(e,n,i,r,u,l){var c,d,f=t.createElement("script"),r=r||h.errorTimeout;f.src=e;for(d in i)f.setAttribute(d,i[d]);n=l?a:n||o,f.onreadystatechange=f.onload=function(){!c&&s(f.readyState)&&(c=1,n(),f.onload=f.onreadystatechange=null)},p(function(){c||(c=1,n(1))},r),u?f.onload():m.parentNode.insertBefore(f,m)},e.yepnope.injectCss=function(e,n,i,r,s,u){var l,r=t.createElement("link"),n=u?a:n||o;r.href=e,r.rel="stylesheet",r.type="text/css";for(l in i)r.setAttribute(l,i[l]);s||(m.parentNode.insertBefore(r,m),p(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("blobconstructor",function(){try{return!!new Blob}catch(e){return!1}}),function(){function e(){Modernizr.addTest("blobworkers",!1),t()}function t(){o&&u.revokeObjectURL(o),r&&r.terminate(),s&&clearTimeout(s)}try{var n,i,r,o,s,a=window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,u=window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL,l="Modernizr",c="this.onmessage=function(e){postMessage(e.data)}";try{n=new Blob([c],{type:"text/javascript"})}catch(d){}n||(i=new a,i.append(c),n=i.getBlob()),o=u.createObjectURL(n),r=new Worker(o),r.onmessage=function(e){Modernizr.addTest("blobworkers",l===e.data),t()},r.onerror=e,s=setTimeout(e,200),r.postMessage(l)}catch(d){e()}}(),function(){try{var e="Modernizr",t=new Worker("data:text/javascript;base64,dGhpcy5vbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7cG9zdE1lc3NhZ2UoZS5kYXRhKX0=");t.onmessage=function(n){t.terminate(),Modernizr.addTest("dataworkers",e===n.data),t=null},t.onerror=function(){Modernizr.addTest("dataworkers",!1),t=null},setTimeout(function(){Modernizr.addTest("dataworkers",!1)},200),t.postMessage(e)}catch(n){Modernizr.addTest("dataworkers",!1)}}(),Modernizr.addTest("filereader",function(){return!!(window.File&&window.FileList&&window.FileReader)}),Modernizr.addTest("sharedworkers",function(){return!!window.SharedWorker}),function(){Nlvx.customFieldsHelper=function(){function e(){}var t,n,i,r,o,s,a;return i=null,t=[],s=[],a=[],r={date:{is:"eq","is not":"ne","is before":"lt","is after":"gt"},text:{is:"eq","is not":"ne","contains word":"contains"},number:{is:"eq","is greater than":"gt","is less than":"lt"},"opens.campaign_identifier":{Opened:"eq"},"clicks.campaign_identifier":{Clicked:"eq"}},o={date:{is:"eq","is not":"ne","is before":"lt","is after":"gt"},text:{is:"eq","is not":"ne","contains word":"contains"},number:{is:"eq","is greater than":"gt","is less than":"lt"},"opens.campaign_identifier":{Opened:"eq","Not Opened":"ne"},"clicks.campaign_identifier":{Clicked:"eq","Not Clicked":"ne"}},n=function(){return Nlvx.flags.usingRiak?o:r},e.getOperatorForQuery=function(e,t){return n()[e][t]},e.getHumanOperatorForQuery=function(e,t){var i,r;return i=n()[e],r=_.invert(i),r[t]},e.getQueries=function(){return n()},e.getQueriesByType=function(e){return n()[e]},e.getConditions=function(){return _.mapObject(n(),function(e){return _.keys(e)})},e.setQueryFields=function(e){return s=e},e.getQueryFields=function(){return s},e.setCustomFields=function(e){return t=e},e.getCustomFields=function(){return t},e.setSystemFields=function(e){return a=e},e.getSystemFields=function(){return a},e.systemFieldAliases={first_name:["First_Name","FName","First-Name","First Name","FirstName"],last_name:["Last_Name","LName","Last-Name","Last Name","LastName"]},e.findSystemFieldFromAlias=function(e){return _.findKey(this.systemFieldAliases,function(t){var n;return n=_.map(t,function(e){return e.toLowerCase()}),_.contains(n,e.toLowerCase())})},e}()}.call(this),function(){var e;e=function(){function e(){}var t,n;return n=null,t=0,e.get=function(){return t++,t},e}(),Nlvx.QueryCreateUpdateModal=function(){function t(t,n){var i;this.$trigger=t,this.options=null!=n?n:{},this.list=this.options.list,this.segment=this.options.segment,this.contactsOnly=this.options.contactsOnly,(this.hasList()||this.hasSegment())&&(this.object=this.list||this.segment),this.uniqueId=e.get(),i=$("#cu-segment-list").html(),this.template=Handlebars.compile(i),this.buildModal(),this.$html.find(".segment_list_id").select2(),this.$submit=this.$html.find(".btn.submit"),this.listForm=new Nlvx.QueryCreateUpdateModal.CSVUploadForm(this.$html.find(".cu-segment-list--csv-upload__file-form"),this.$html.find(".cu-segment-list--csv-upload__list-form"),this.object),this.manualForm=new Nlvx.QueryCreateUpdateModal.ManualForm(this.$html.find(".cu-segment-list--manual__form")),this.segmentForm=new Nlvx.QueryCreateUpdateModal.SegmentationForm(this.$html.find(".cu-segment-list--segment__form"),this.object),this.manualForm.getAnalyticsArgs=function(){return["manual_add"]},this.segmentForm.getAnalyticsArgs=function(e){return function(){return["segment_created",{conditions_count:e.segmentForm.getQueries().length,field_types:_.sortBy(_.uniq(e.segmentForm.getQueryFieldTypes()),function(e){return e})}]}}(this),$(this.listForm).on("close",function(e){return function(){return e.$modal.modal("hide")}}(this)),this.children={},this.children["cu_new_upload_contact_"+this.uniqueId]=this.listForm,this.children["cu_new_manual_contact_"+this.uniqueId]=this.manualForm,this.children["cu_new_segmentation_"+this.uniqueId]=this.segmentForm,this.bindEvents()}return t.prototype.bindEvents=function(){return this.$trigger.on("click",_.bind(this.onTriggerClick,this)),this.$submit.on("click",_.bind(this.onSubmit,this)),this.$modal.find(".nav-tabs a[data-toggle='tab']").on("click",function(e){return function(t){var n;return n=$(t.currentTarget).attr("href").replace("#",""),e.$modal.attr("data-activetab",n)}}(this)),$(this.listForm).on("cancel",function(){}),$(this.listForm).on("error",function(){}),$(this.listForm).on("invalid",function(){})},t.prototype.buildModal=function(){return this.$html=$(this.template(this)),this.$modal=this.$html.modal({show:!1}).appendTo("body")},t.prototype.onTriggerClick=function(e){var t,n;return t=null!=(n=$(e.currentTarget).data("tab"))?n.replace("#",""):void 0,(!t&&"list"===$(e.currentTarget).data("type")||$(e.currentTarget).data("all-contacts"))&&(t="new_upload_contact"),t&&this.$html.find("a[href='#cu_"+t+"_"+this.uniqueId+"']").tab("show"),e.preventDefault(),this.$modal.attr("data-activetab","cu_"+t+"_"+this.uniqueId),this.$modal.modal("show")},t.prototype.hasList=function(){return null!=this.list},t.prototype.hasSegment=function(){return null!=this.segment},t.prototype.onSubmit=function(e){var t;return e.preventDefault(),t=this.activeObject(),t?(t.getAnalyticsArgs&&window.analytics.track.apply(void 0,t.getAnalyticsArgs()),t.submit()):void 0},t.prototype.activeObject=function(){var e,t;return e=this.$html.find("ul.nav-tabs li.active a").attr("href"),(null!=e?e.length:void 0)?(t=e.replace("#",""),this.children[t]):this.segment&&this.segment?this.segmentForm:void 0},t}()}.call(this),function(){var e,t;Nlvx.QueryCreateUpdateModal.CSVUploadForm=function(){function n(e,n,i){this.$uploadform=e,this.$listForm=n,this.object=i,this.createDropzone(),this.createFileUploader(),this.uploader.$element.on("cancel",function(e){return function(){return $(e).trigger("cancel")}}(this)),this.uploader.$element.on("error",function(e){return function(){return $(e).trigger("error")}}(this)),this.uploader.$element.on("invalid",function(e){return function(){return $(e).trigger("invalid")}}(this)),this.overlay=$(t),this.$progressBar=this.overlay.find(".csv-upload-overlay--progress"),this.bindEvents()}return n.prototype.bindEvents=function(){return this.$uploadform.on("submit",_.bind(this.onChildSubmit,this)),this.$listForm.on("submit",_.bind(this.onChildSubmit,this)),$(this.uploader).on({"upload:start":_.bind(this.onUploadStart,this),"upload:fail":_.bind(this.onUploadFail,this)}),this.$listForm.find(".list-select-toggle").on("click",function(e){return function(t){var n,i,r,o;return t.preventDefault(),i=$(t.currentTarget),r=i.closest("[role='list-selection']"),o=i.data("connected"),n=e.$listForm.find("[role='"+o+"']"),r.toggleClass("active-new"),r.find("fieldset").attr("disabled","disabled"),n.removeAttr("disabled")}}(this)),$(this.uploader).on("upload:add",_.bind(this.onUploadAdd,this)),$("[data-role=cancel-csv-upload]").on("click",function(e){return function(){return $(e).trigger("close")}}(this))},n.prototype.onUploadAdd=function(e){return e.name.match(/.*\.csv$/i)?($("[data-role=dropzone-no-file-added-content]").hide(),this.customFieldsBuilder&&this.customFieldsBuilder.destroy(),this.customFieldsBuilder=new Nlvx.CustomFieldsBuilder(this.$listForm.parents(".modal"),e),$(this.customFieldsBuilder).on("submit",function(t){return function(n,i){return $(t.uploader).off("upload:add"),t.uploader.changeFile(e),t.submit(i.rebuiltHeaders,i.delimiter)}}(this))):(this.uploader.dropzone.removeFile(e),void Nlvx.FlashMessageHandler.add("danger","Only .csv files are accepted. Please change the format of your file and upload again."))},n.prototype.onChildSubmit=function(e){return e.preventDefault(),this.submit()},n.prototype.onUploadFail=function(){return this.overlay.remove()},n.prototype.onUploadStart=function(){return $(this).trigger("close"),$("main").append(this.overlay)},n.prototype.onUploadProgress=function(e,t){return this.$progressBar.find("span").css("width",""+t+"%")},n.prototype.createFileUploader=function(){return this.uploader=new Nlvx.DropzoneUploader(this.$uploadform,this.dropzone,{url:this.$uploadform.attr("action")})},n.prototype.createDropzone=function(){var t;if(null!=this.$uploadform.get(0))return this.dropzone=new Dropzone(this.$uploadform.get(0),{paramName:"file",autoProcessQueue:!1,clickable:!0,uploadMultiple:!1,maxFilesize:2e3,acceptedFiles:"text/csv, .csv",previewsContainer:".dropzone-previews",previewTemplate:e,addRemoveLinks:!0,dictRemoveFile:"Remove"}),t=function(e){return function(t){return e.uploader.validateFileSize(t.size)?e.onUploadAdd(t):e.dropzone.removeAllFiles()}}(this),this.dropzone.on("uploadprogress",_.bind(this.onUploadProgress,this)),this.dropzone.on("addedfile",_.bind(t,this)),this.dropzone.on("removedfile",function(){return $("[data-role=dropzone-no-file-added-content]").show(),$("#exceeding-free-limit-warning").addClass("hidden")})},n.prototype.submit=function(e,t){return this.hasFileAttached()?$.when(this.getOrCreateList()).then(function(n){return function(i){return $.post(n.$uploadform.data("policy-url"),function(r){return n.$uploadform.find("input[name=key]").val(r.key),n.$uploadform.find("input[name=policy]").val(r.policy),n.$uploadform.find("input[name=signature]").val(r.signature),n.uploader.submit(r.key,i.id,e,t,n.dropzone)})}}(this)).fail(function(e,t,n){var i;try{return i=JSON.parse(e.responseText),Nlvx.FlashMessageHandler.add("danger",i.message)}catch(r){if(n=r,null!=("undefined"!=typeof console&&null!==console?console.log:void 0))return console.log(n)}}):this.uploader.displayError("please select a file")},n.prototype.getOrCreateList=function(){var e,t,n;return e=null!=(t=_.find(this.$listForm.serializeArray(),function(e){return"list_id"===e.name}))?t.value:void 0,null!=this.object||null!=e?$.Deferred().resolve({id:(null!=(n=this.object)?n.id:void 0)||e}):$.Deferred(function(e){return function(t){return $.ajax({type:"POST",url:e.$listForm.attr("action"),data:e.$listForm.serialize(),success:t.resolve,error:t.reject})}}(this)).promise()},n.prototype.hasFileAttached=function(){return null!=this.uploader.file},n}(),t='<div class="overlay csv-upload-overlay">\n  <div class="overlay-content">\n    <i></i>\n    <h1>We are currently uploading your CSV</h1>\n    <p>Please do not close your browser</p>\n    <div class="csv-upload-overlay--progress">\n      <span></span>\n    </div>\n  </div>\n</div>',e='<div>\n  <div class="dz-filename"><span data-dz-name></span></div>\n</div>'}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};Nlvx.CustomFieldsBuilder=function(){function n(n,i){var r,o,s,a;this.$parentModal=n,this.file=i,this.isExceedingFreeLimit=t(this.isExceedingFreeLimit,this),this.fields=[],this.modalTemplate||(this.modalTemplate=Handlebars.compile(e)),this.parser=new Nlvx.CustomFieldsBuilder.csvFile(this.file),$(this.parser).on("preview:complete",_.bind(this.onPreviewFileParseComplete,this)),$(this.parser).on("error",_.bind(this.onPapaError,this)),this.parser.preview(),this.$parentModal.on("hidden.bs.modal",function(e){return function(){return e.$modal?e.$modal.remove():void 0}}(this)),$("[data-role=confirm-csv-upload]").off("click"),$("[data-role=confirm-csv-upload]").on("click",_.bind(this.open,this)),o=_.sortBy(Nlvx.customFieldsHelper.getCustomFields(),"name"),a=Nlvx.customFieldsHelper.getSystemFields(),r=_.map(o,function(e){return e.name.toLowerCase()}),s=_.map(a,function(e){return e.field_name.toLowerCase()}),this.allExistingFieldNames=r.concat(s)}return n.prototype.bindEvents=function(){return this.$modal.find(".back-arrow").on("click",function(e){return function(t){return t.preventDefault(),e.$modal.removeClass("in"),$(e).trigger("back")}}(this)),this.$modal.find(".submit").on("click",_.bind(this.submit,this))},n.prototype.submit=function(e){var t,n,i,r,o,s,a,u,l,c,d,h,f,p;if(e.preventDefault(),$(".csv-column-preview-group--header.error").removeClass("error"),this.allFieldsAreSelected()){if(this.allNewFieldsAreNew()){if(this.allFieldsAreUnique())return this.alert&&this.alert.remove(),$(".csv-column-preview-group--header.error").removeClass("error"),this.alert=null,n=_.filter(this.fields,function(e){return e.isCreatingField()&&e.shouldBeSaved}),$.when(this.saveCustomFields(n)).then(function(e){return function(){return e.hide(),$(e).trigger("submit",{rebuiltHeaders:e.rebuildHeaders(),delimiter:e.delimiter})}}(this)).fail(function(e){return function(t){var n,i,r,o,s;for(i=_.uniq(_.map(t,function(e){return e.errorMessage})),e.showError("We failed to create your custom fields for the following reasons: "+i.join(" ")),s=[],r=0,o=t.length;o>r;r++)n=t[r],s.push(n.parentField.highlight("error"));return s}}(this));for(this.showError("Each custom field can only be applied to a column once. Please check your columns and try again."),d=this.getDuplicateFields(),p=[],o=0,u=d.length;u>o;o++)t=d[o],p.push(t.highlight("error"));return p}for(this.showError("You already have a custom field with the same name."),c=this.getNewFieldsThatExist(),f=[],r=0,a=c.length;a>r;r++)t=c[r],f.push(t.highlight("error"));return f}for(this.showError("Some of your custom fields have not been selected."),l=this.getFieldsWithoutValue(),h=[],i=0,s=l.length;s>i;i++)t=l[i],h.push(t.highlight("error"));return h},n.prototype.showError=function(e,t){return null==e&&(e=""),null==t&&(t="error"),this.alert&&this.alert.remove(),this.alert=new Nlvx.Alert(e,this.$modal.find(".modal-body"),t),this.alert.show()},n.prototype.getSavingFields=function(){return _.filter(this.fields,function(e){return e.shouldBeSaved})},n.prototype.allNewFieldsAreNew=function(){return this.getNewFieldsThatExist().length<1},n.prototype.getNewFieldsThatExist=function(){var e;return e=_.filter(this.getSavingFields(),function(e){return e.isCreatingField()}),_.filter(e,function(e){return function(t){return _.contains(e.allExistingFieldNames,t.getName().toLowerCase())}}(this))},n.prototype.allFieldsAreUnique=function(){return this.getDuplicateFields().length<1},n.prototype.getDuplicateFields=function(){var e,t;return t=_.groupBy(this.getSavingFields(),function(e){return e.getName().toLowerCase()}),e=_.filter(t,function(e){return e.length>1}),_.flatten(_.values(e))},n.prototype.allFieldsAreSelected=function(){var e;return e=this.getFieldsWithoutValue(),e.length<1},n.prototype.getFieldsWithoutValue=function(){return _.reject(this.getSavingFields(),function(e){return e.hasValue()})},n.prototype.rebuildHeaders=function(){return _.map(this.fields,function(e){return{name:e.getName(),should_be_saved:e.shouldBeSaved}})},n.prototype.saveCustomFields=function(e){var t,n,i,r;return r=e.length,t=0,n=0,i=[],$.Deferred(function(o){var s,a,u,l;if(e.length){for(l=[],a=0,u=e.length;u>a;a++)s=e[a],$(s.createField).on("ajax:success",function(){return t++,t>=r?o.resolve():void 0}),$(s.createField).on("ajax:fail",function(e,s){return n++,i.push(s.failedField),n+t>=r?o.reject(i):void 0}),l.push(s.create());return l}return o.resolve()}).promise()},n.prototype.open=function(){return this.$modal&&this.$modal.remove(),this.$modal=$(this.modalTemplate()),this.buildRows(),this.$parentModal.find(".modal-dialog").append(this.$modal),this.bindEvents(),window.setTimeout(function(e){return function(){return e.show()}}(this),500)},n.prototype.show=function(){return this.$modal.addClass("in")},n.prototype.hide=function(){return this.$modal.removeClass("in")},n.prototype.destroy=function(){return this.$modal?this.$modal.remove():void 0},n.prototype.autoMatchToSystemField=function(e){return Nlvx.customFieldsHelper.findSystemFieldFromAlias(e)},n.prototype.buildRows=function(){var e;return this.csvData?(this.headers=this.csvData[0],this.rows=this.csvData.slice(1),e=_.map(this.rows,function(e){return e.length}).concat(this.headers.length).sort().pop(),_(e).times(function(e){return function(t){var n,i,r;return i=e.headers[t]||"",r=e.autoMatchToSystemField(i),null!=r&&(i=r),n=new Nlvx.CustomFieldsBuilder.Field(i,_.map(e.rows,function(e){return e[t]})),$(n).on("message",function(t,n){return e.showError(n.message,n.type)}),n.build(),e.fields.push(n),e.$modal.find(".modal-body").append(n.getHTML())}}(this))):void 0},n.prototype.onPreviewFileParseComplete=function(e,t){var n,i,r;return n=t.csvData,this.csvErrors=n.errors,this.csvData=n.data,this.csvData[0]=_.map(this.csvData[0],function(e){return e.trim().replace(/\s/g,"_")}),_.contains(this.csvData[0],"email")||_.contains(this.csvData[0],"Email")||(this.$parentModal.modal("hide"),Nlvx.FlashMessageHandler.add("danger",'We were unable to detect an email column in the CSV file headers. The email column must always have a header of "email".')),i=1===this.csvData[0].length,r=!_.isEmpty(_.findWhere(this.csvErrors,{code:"UndetectableDelimiter"})),!this.csvErrors.length||i||r?(this.delimiter=t.csvData.meta.delimiter,this.isExceedingFreeLimit(t.csvContactsCount)?$("#exceeding-free-limit-warning").removeClass("hidden"):this.open()):Nlvx.FlashMessageHandler.add("danger","We encountered an error attempting to process your CSV file. Please ensure the file is a valid CSV file before trying again.")},n.prototype.onPapaError=function(){return Nlvx.FlashMessageHandler.add("danger","We encountered an error attempting to process your CSV file. Please ensure the file is a valid CSV file before trying again.")},n.prototype.isExceedingFreeLimit=function(e){var t;return t=$("[data-saved-contacts-count]").data("saved-contacts-count"),t>2e3?!1:t+e>2e3},n}(),e='<div class="modal-content custom-fields-builder">\n  <div class="modal-header">\n    <h4 class="modal-title"><a class="back-arrow" href="#"></a> Assign Custom Fields</h4>\n    <div class="modal-actions">\n      <button type="button" data-dismiss="modal" class="btn btn-secondary">Cancel</button>\n      <button class="btn btn-primary submit">Save</button>\n    </div>\n    <div class="clearfix"></div>\n  </div>\n  <div class="modal-body">\n  </div>\n</div>'}.call(this),function(){Nlvx.CustomFieldsBuilder.csvFile=function(){function e(e){this.file=e}return e.prototype.preview=function(){return Papa.parse(this.file,{delimiter:"",preview:2002,fastMode:!1,complete:function(e){return function(t){var n;return n=t.data.length-1,t.data=t.data.slice(0,4),$(e).trigger("preview:complete",{csvData:t,csvContactsCount:n})}}(this),error:function(e){return function(){return $(e).trigger("error",arguments)}}(this)})},e}()}.call(this),function(){var e;Nlvx.CustomFieldsBuilder.Field=function(){function t(t,n){this.header=t,this.rows=n,this.fieldTemplate=Handlebars.compile(e),this.customFields=_.sortBy(Nlvx.customFieldsHelper.getCustomFields(),"name"),this.systemFields=Nlvx.customFieldsHelper.getSystemFields(),this.shouldBeSaved=!0}return t.prototype.build=function(){var e,t,n;return this.$html=$(this.fieldTemplate(this)),this.$html.find("select").select2(),this.bindEvents(),t=new RegExp(this.header,"i"),e=_.find(this.customFields.concat(this.systemFields),function(){return function(e){return t.test(e.field_name||e.name)}}(this)),(null!=(n=this.header)?n.length:void 0)?e?this.$html.find("select").val(e.field_name||e.name).trigger("change"):(this.$html.find("select").val("create:text").trigger("change"),this.$html.find(".js-new-custom-field-input").val(this.header),$(this).trigger("message",{message:"Please check the column headers below to confirm we've labeled them correctly.",type:"warning"}),this.highlight("warning")):void 0},t.prototype.bindEvents=function(){return this.$html.find("select").on("change",_.bind(this.onChange,this)),this.$html.on("change","select,input.js-new-custom-field-input",function(e){return function(){return e.$html.find(".csv-column-preview-group--header").removeClass(e.hasValue()?"error warning":"warning")}}(this)),this.$html.on("change","input.should-ignore-column",function(e){return function(t){var n;return n=$(t.currentTarget),e.shouldBeSaved=!n.is(":checked")}}(this))},t.prototype.onChange=function(e){var t,n,i,r,o;return n=$(e.currentTarget),o=n.val(),$.trim(this.$html.find(".js-new-custom-field-input").val()).length&&(i=$.trim(this.$html.find(".js-new-custom-field-input").val())),this.$html.find(".js-new-custom-field-input").remove(),/create\:/.test(o)?(r=o.replace("create:",""),this.createField=new Nlvx.CustomFieldsBuilder.FieldCreate(r,n,this),this.$html.find(".js-new-custom-field-input").val(i)):this.createField=null,t=this.$html.find(".checkbox.should-ignore-column"),this.isSkippableField(o)?t.show():(t.hide(),t.find("input[type=checkbox]").prop("checked",!1).trigger("change"))},t.prototype.getHTML=function(){return this.$html},t.prototype.isSkippableField=function(e){return!this.findField(_.where(this.systemFields,{field_name:"email"}),e)},t.prototype.findField=function(e,t){var n;return n=new RegExp(t,"i"),_.find(e,function(){return function(e){return n.test(e.field_name||e.name)}}(this))},t.prototype.isCreatingField=function(){return null!=this.createField},t.prototype.hasValue=function(){return this.isCreatingField()?this.createField.isValid():this.getName().length>0},t.prototype.create=function(){return this.createField?this.createField.create():void 0},t.prototype.getName=function(){return this.isCreatingField()?this.createField.getName():this.$html.find("select").val()||""},t.prototype.highlight=function(e){var t;return t=["error","warning"],_.contains(t,e)?this.$html.find(".csv-column-preview-group--header").addClass(e):void 0},t}(),e='<div class="csv-column-preview-group">\n  <div class="csv-column-preview-group--header">\n    <div class="checkbox pull-right should-ignore-column">\n      <label class="text-capitalize light">\n        <input type="checkbox" class="should-ignore-column"> &nbsp;Skip Column\n      </label>\n    </div>\n    <select>\n      <option value=""></option>\n      <optgroup class="js-create-custom-field" label="Create Fields">\n        <option value="create:text">New text field</option>\n        <option value="create:number">New number field</option>\n        <option value="create:date">New date field</option>\n      </optgroup>\n      <optgroup label="System Fields">\n      {{#systemFields}}\n      <option value="{{field_name}}">{{name}}</option>\n      {{/systemFields}}\n      </optgroup>\n      <optgroup label="Custom Fields">\n      {{#customFields}}\n      <option value="{{name}}">{{name}}</option>\n      {{/customFields}}\n      </optgroup>\n    </select>\n  </div>\n  {{#rows}}\n  <div class="csv-column-preview-group--row">\n    {{.}}\n  </div>\n  {{/rows}}\n  <div class="csv-column-preview-group--row">\n    &hellip;\n  </div>\n</div>'}.call(this),function(){Nlvx.CustomFieldsBuilder.FieldCreate=function(){function e(e,t,n){this.type=e,this.$select=t,this.parentField=n,this.$input=$("<input type='text' class='js-new-custom-field-input new-custom-field-input'>"),this.$select.after(this.$input),this.name=null,this.hasBeenCreated=!1}return e.prototype.isValid=function(){var e;return e=$.trim(this.$input.val()),e.length>0},e.prototype.getName=function(){return this.$input.val()},e.prototype.create=function(){var e,t;return this.errorMessage=null,this.name=this.$input.val(),e=0,(t=function(n){return function(){return n.hasBeenCreated?void $(n).trigger("ajax:success"):(e+=1,$.ajax({type:"POST",url:"/marketing_campaigns/custom_fields.json",data:{custom_field:{type:n.type,name:n.name}},success:function(){return window.analytics.track("custom_field_created",{source:"csv_upload",field_type:n.type}),$(n).trigger("ajax:success"),n.hasBeenCreated=!0},error:function(i){var r,o;try{if(o=JSON.parse(i.responseText),r=4===Math.floor(i.status/100),r&&o.message.match("name must be unique"))return 3>e?void setTimeout(t,300*e):($(n).trigger("ajax:success"),void(n.hasBeenCreated=!0));n.errorMessage=o.message}catch(s){n.errorMessage=null}return $(n).trigger("ajax:fail",{failedField:n})}}))}}(this))()},e}()}.call(this),function(){Nlvx.QueryCreateUpdateModal.ManualForm=function(){function e(e){this.$form=e,this.actionUrl=this.$form.attr("action"),this.$emailInput=this.$form.find("[name='profile[email]']"),this.bindEvents()
}return e.prototype.bindEvents=function(){return this.$form.on("submit",function(e){return function(t){return t.preventDefault(),e.submit()}}(this)),this.$form.find(".list-select-toggle").on("click",function(e){return function(t){var n,i,r,o;return t.preventDefault(),i=$(t.currentTarget),r=i.closest("[role='list-selection']"),o=i.data("connected"),n=e.$form.find("[role='"+o+"']"),r.toggleClass("active-new"),r.find("fieldset").attr("disabled","disabled"),n.removeAttr("disabled")}}(this))},e.prototype.submit=function(){return this.hasValidEmail()?$.ajax({url:this.actionUrl,type:"POST",dataType:"json",data:this.$form.serialize(),success:this.onSubmitSuccess,error:this.onSubmitError}):Nlvx.FlashMessageHandler.add("danger","Please enter a valid email address.")},e.prototype.hasValidEmail=function(){return Nlvx.EmailValidator.is_valid(this.$emailInput.val())},e.prototype.onSubmitSuccess=function(e){return null!=(null!=e?e.redirect_to:void 0)?Nlvx.WindowHandler.redirect(e.redirect_to):Nlvx.WindowHandler.reload()},e.prototype.onSubmitError=function(e){var t,n,i;i=e.responseText;try{return n=JSON.parse(i),Nlvx.FlashMessageHandler.add("danger",n.message)}catch(r){if(t=r,null!=("undefined"!=typeof console&&null!==console?console.log:void 0))return console.log(t)}},e}()}.call(this),function(){Nlvx.SegmentBuilder=function(){function e(e,t){var n,i,r,o;if(this.$container=e,null==t&&(t=[]),this.queryObjects=[],this.segmentQueries=new Nlvx.SegmentBuilder.SegmentQueries,this.customFields=Nlvx.customFieldsHelper.getQueryFields(),t.length)for(r=0,o=t.length;o>r;r++)i=t[r],n=_.find(this.customFields,function(){return function(e){return e.field_name===i.field||e.name===i.field}}(this)),i.operator&&(i.operator=Nlvx.customFieldsHelper.getHumanOperatorForQuery(n.type,i.operator)),this.addQuery(i);else this.addQuery({})}return e.prototype.addQuery=function(e){var t,n;return null==e&&(e={}),t=this.segmentQueries.add(e),n=new Nlvx.SegmentBuilder.SegmentQuery(t,this.$container,this.segmentQueries),this.queryObjects.push(n),$(n).on("add",function(e){return function(){return e.addQuery()}}(this)),$(n).on("remove",function(e){return function(t,n){return e.removeQuery(n)}}(this))},e.prototype.removeQuery=function(e){var t,n,i,r,o,s;for(t=_.find(this.queryObjects,function(t){return t.id===e}),this.queryObjects=_.reject(this.queryObjects,function(t){return t.query.id===e}),this.segmentQueries.remove(e),o=this.queryObjects,s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(n.render());return s},e.prototype.getQueries=function(){var e;return e=_.compact(_.map(this.queryObjects,function(e){return e.toJson()})),(null!=e?e.length:void 0)&&(e[0].and_or=""),e},e}()}.call(this),function(){Nlvx.SegmentBuilder.SegmentQueries=function(){function e(){this.count=0,this.queries=[]}return e.prototype.add=function(e){return null==e&&(e={}),e.id||(e.id=this.count),e.and_or||(e.and_or="and"),this.count=this.count+1,this.queries.push(e),e},e.prototype.get=function(){return this.queries},e.prototype.remove=function(e){return null==e&&(e=null),null!=e?this.queries=_.reject(this.queries,function(t){return t.id===e}):void 0},e.prototype.update=function(e){return null==e&&(e={id:-1}),this.queries=_.reject(this.queries,function(t){return t.id===e.id}),this.queries.push(e)},e}()}.call(this),function(){Nlvx.SegmentBuilder.SegmentQuery=function(){function e(e,n,o){this.query=null!=e?e:{},this.$container=n,this.segmentQueries=o,this.selectTemplate=Handlebars.compile(r),this.queryTemplate=Handlebars.compile(i),this.inputTemplate=Handlebars.compile(t),this.$content=$(this.queryTemplate()),this.$container.append(this.$content),this.$field=this.$content.find(".js-new-segmentation__field"),this.$condition=this.$content.find(".js-new-segmentation__condition"),this.$value=this.$content.find(".js-new-segmentation__query-value"),this.customFields=Nlvx.customFieldsHelper.getQueryFields(),this.conditions=Nlvx.customFieldsHelper.getConditions(),this.$content.find(".join").on("click",_.bind(this.onJoinChange,this)),this.$content.find(".query-add").on("click",function(e){return function(t){var n;return n=$(t.currentTarget),n.hasClass("active")?(n.hide(),$(e).trigger("add")):void 0}}(this)),this.$content.find(".query-remove").on("click",function(e){return function(t){return t.preventDefault(),e.$content.remove(),$(e).trigger("remove",e.query.id)}}(this)),this.$content.on({mouseover:function(e){return function(){return!e.isFirstQuery()||e.formHasMultipleQueries()?e.$content.find(".query-remove .icon-remove").show():void 0}}(this),mouseout:function(e){return function(){return e.$content.find(".query-remove .icon-remove").hide()}}(this)}),this.render()}var t,n,i,r;return r='<select class="{{cssClass}}" name="{{name}}" id="{{name}}">\n  <option value="">Select {{type}}</option>\n  {{#each options}}\n    {{#if selected}}\n    <option value="{{value}}" selected="selected">{{name}}</option>\n    {{else}}\n    <option value="{{value}}">{{name}}</option>\n    {{/if}}\n  {{/each}}\n</select>',i='<fieldset>\n    <span class="join" data-join="and">AND</span>\n    <span class="join" data-join="or">OR</span>\n  <div class="condition-select js-new-segmentation__field"></div>\n  <div class="condition-select js-new-segmentation__condition"></div>\n  <div class="condition-select js-new-segmentation__query-value"></div>\n  <span class="icon-wrapper query-remove">\n    <i class="icon-remove" style="display:none"></i>\n  </span>\n  <span class="icon-wrapper query-add">\n    <i class="icon-add"></i>\n  </span>\n</fieldset>',t='<input type="text" placeholder="{{placeholder}}" name="query_value" value="{{value}}">',n={date:"MM/DD/YYYY"},e.prototype.hideAllAddButtons=function(){return this.$container.find(".query-add").hide()},e.prototype.hideAddButton=function(){return this.$content.find(".query-add").hide()},e.prototype.showAddButton=function(){return this.$content.find(".query-add").show()},e.prototype.dimAddButton=function(){return this.$content.find(".query-add").removeClass("active")},e.prototype.brightenAddButton=function(){return this.$content.find(".query-add").addClass("active")},e.prototype.onJoinChange=function(e){var t;return t=$(e.currentTarget),this.query.and_or=t.data("join"),this.$content.find(".join").removeClass("active"),t.addClass("active")},e.prototype.render=function(){var e,t,i,r,o;return r=_.map(this.customFields,function(e){return function(t){return{value:t.field_name||t.name,name:t.name,selected:null!=e.query.field&&(e.query.field===t.field_name||e.query.field===t.name)}}}(this)),this.$fieldSelect=$(this.selectTemplate({options:r,cssClass:"",type:"Condition",name:"field"})),this.$field.html(this.$fieldSelect),this.$fieldSelect.on("change",_.bind(this.onFieldChange,this)),null!=this.query.field&&(i=_.find(this.customFields,function(e){return function(t){return t.field_name===e.query.field||t.name===e.query.field}}(this)),null!=this.fieldType&&this.fieldType!==i.type&&(this.query.operator=null,this.query.value=null),this.fieldType=i.type,t=_.map(this.conditions[this.fieldType],function(e){return function(t){return{value:t,name:t,selected:null!=e.query.operator&&e.query.operator===t}}}(this)),this.$conditionSelect=$(this.selectTemplate({options:t,cssClass:"",type:"Criteria",name:"operator"})),this.$condition.html(this.$conditionSelect),this.$conditionSelect.on("change",_.bind(this.onConditionChange,this))),null!=this.query.operator?"number"===this.fieldType||"text"===this.fieldType||"date"===this.fieldType?(this.$valueInput=$(this.inputTemplate({placeholder:n[this.fieldType]||"",value:this.query.value||null})),this.$value.html(this.$valueInput),this.$valueInput.on("blur",_.bind(this.onValueBlur,this)),this.$valueInput.on("keyup",_.bind(this.onValueKeyup,this))):("opens.campaign_identifier"===this.fieldType||"clicks.campaign_identifier"===this.fieldType)&&(e=_.find(this.customFields,function(e){return function(t){return t.field_name===e.fieldType}}(this)),o=_.map(e.options,function(e){return function(t){return{value:t.id,name:t.label,selected:e.query.value===t.id}}}(this)),this.$valueSelect=$(this.selectTemplate({options:o,cssClass:"",type:"Campaign",name:"value"})),this.$value.html(this.$valueSelect),this.$valueSelect.on("change",_.bind(this.onValueChange,this))):this.$value.empty(),this.isLastQuery()?(this.hideAllAddButtons(),this.showAddButton(),this.query.value?this.brightenAddButton():this.dimAddButton()):this.hideAddButton(),null==this.query.and_or||this.isFirstQuery()?this.$content.find(".join").hide():(this.$content.find(".join").removeClass("active").show(),this.$content.find(".join[data-join='"+this.query.and_or+"']").addClass("active")),this.$content.find("select").select2()},e.prototype.isLastQuery=function(){var e,t;return t=this.$container.find("fieldset").index(this.$content),e=this.$container.find("fieldset").length,t===e-1},e.prototype.isFirstQuery=function(){var e;return e=this.$container.find("fieldset").index(this.$content),0===e},e.prototype.formHasMultipleQueries=function(){return this.$container.find("fieldset").length>1},e.prototype.onFieldChange=function(){return this.query.field=this.$fieldSelect.val(),""===this.query.field&&(this.query.operator=null,this.query.field=null,this.query.value=null),this.segmentQueries.update(this.query),this.render()},e.prototype.onConditionChange=function(){return this.query.operator=this.$conditionSelect.val(),""===this.query.operator&&(this.query.operator=null,this.query.value=null),this.segmentQueries.update(this.query),this.render()},e.prototype.onValueBlur=function(){return this.query.value=this.$valueInput.val(),this.segmentQueries.update(this.query)},e.prototype.onValueKeyup=function(){return this.isLastQuery()?(this.showAddButton(),this.$valueInput.val().length?this.brightenAddButton():this.dimAddButton()):this.hideAddButton()},e.prototype.onValueChange=function(){return this.query.value=this.$valueSelect.val(),this.segmentQueries.update(this.query),this.render()},e.prototype.getFieldType=function(){var e;return e=this.$fieldSelect.val(),e?_.include(["opens.campaign_identifier","clicks.campaign_identifier"],e.toLowerCase())?"engagement":_.include(["first_name","last_name","email","created_at","updated_at","last_emailed","last_clicked","last_opened"],e.toLowerCase())?"reserved":"custom":void 0},e.prototype.toJson=function(){var e;return this.query.field&&this.query.operator&&this.query.value?(e=_.clone(this.query),this.isFirstQuery()&&(e.and_or=""),e.operator=Nlvx.customFieldsHelper.getOperatorForQuery(this.fieldType,e.operator),delete e.id,e):void 0},e}()}.call(this),function(){Nlvx.QueryCreateUpdateModal.SegmentationForm=function(){function e(e,t){var n;this.$form=e,this.listOrSegment=t,this.$conditions=this.$form.find(".conditions"),this.actionUrl=this.$form.attr("action"),this.conditions=null!=(n=this.listOrSegment)?n.conditions:void 0,this.segmentBuilder=new Nlvx.SegmentBuilder(this.$conditions,this.conditions),this.$form.on("submit",function(e){return function(t){return t.preventDefault(),e.submit()}}(this))}return e.prototype.submit=function(){var e,t;return e=this.getQueries(),this.$form.find("[name='conditions']").val(JSON.stringify(e)),$.ajax(this.conditions&&(null!=(t=this.listOrSegment)?t.id:void 0)?{url:""+this.actionUrl+"/"+this.listOrSegment.id,type:"PUT",dataType:"json",data:this.$form.serialize(),success:this.onSubmitSuccess,error:this.onSubmitError}:{url:this.actionUrl,type:"POST",dataType:"json",data:this.$form.serialize(),success:this.onSubmitSuccess,error:this.onSubmitError})},e.prototype.onSubmitSuccess=function(e){return null!=(null!=e?e.redirect_to:void 0)?Nlvx.WindowHandler.redirect(e.redirect_to):Nlvx.WindowHandler.reload()},e.prototype.onSubmitError=function(e){var t,n,i;i=e.responseText;try{return n=JSON.parse(i),Nlvx.FlashMessageHandler.add("danger",n.message)}catch(r){if(t=r,null!=("undefined"!=typeof console&&null!==console?console.log:void 0))return console.log(t)}},e.prototype.getQueries=function(){return _.compact(this.segmentBuilder.getQueries())},e.prototype.getQueryFieldTypes=function(){return _.map(this.segmentBuilder.queryObjects,function(e){return e.getFieldType()})},e}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};Nlvx.TitleUpdater=function(){function t(t,n){this.keyupHandler=e(this.keyupHandler,this),this.keydownHandler=e(this.keydownHandler,this),this.pasteHandler=e(this.pasteHandler,this),this.$target=$(t),this.$title=null,this.$editModalTitle=null,this.path=n}return t.prototype.bindEvents=function(){return this.$title=this.$target.find(".profiles-title h3"),this.$editModalTitle=this.$target.find(".edit-segment-modal-title"),this.$title.off("keydown"),this.$title.off("keyup"),this.$title.on("keyup",this.keyupHandler),this.$title.on("keydown",this.keydownHandler),this.$title.on("paste",this.pasteHandler)},t.prototype.pasteHandler=function(e){var t;return e.preventDefault(),t=(e.originalEvent||e).clipboardData.getData("text/plain"),this.pasteText(t)},t.prototype.keydownHandler=function(e){return 13===e.key||13===e.keyCode?!1:void 0},t.prototype.keyupHandler=function(e){var t;return(13===e.key||13===e.keyCode)&&(t=this.$title.text(),$.ajax(this.path,{method:"PUT",data:{name:t},success:function(n){return function(){return n.$editModalTitle.text(t),$(e.target).blur()}}(this),error:function(e){return Nlvx.FlashMessageHandler.add("danger",JSON.parse(e.responseText).message)}})),!1},t.prototype.pasteText=function(e){return document.execCommand("insertText",!1,e)},t}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};Nlvx.NotificationEmailsView=function(){function n(e,n,i){this.$table=e,this.$modal=n,this.$form=i,this.renumberRows=t(this.renumberRows,this),this.fadeTime=500,this.build()}var i;return i=10,n.prototype.build=function(){return this.enforceMaxRows(),this.afterBuild(),this.notificationEmailRowTemplate=Handlebars.compile(e)},n.prototype.afterBuild=function(){return this.bindEvents()},n.prototype.onFormSubmit=function(e){return e.preventDefault()},n.prototype.bindEvents=function(){return this.$form.on("submit",function(e){return function(t){return e.onFormSubmit(t)}}(this)),this.$modal.on("click",".submit",function(e){return function(){return e.$form.submit()}}(this)),this.$modal.on("click",".cancel",function(e){return function(){return e.$modal.modal("hide"),e.$form.trigger("reset")}}(this)),this.$table.on("click",".notification-email-recipient .delete",function(e){return function(t){var n,i;return n=$(t.currentTarget),i=n.parents(".notification-email-recipient"),e.deleteRow(i)}}(this)),this.$table.on("change",function(e){return function(){return e.onChange()}}(this)),this.initializeFormValidator()},n.prototype.initializeFormValidator=function(){return $.validator.addMethod("unique",function(e,t,n){return!_.contains(n,e)},"Please ensure the value is unique."),this.$form.validate({rules:{contact_label:{maxlength:100},contact:{maxlength:100,unique:function(e){return function(){return e.getEmails()}}(this)()}},messages:{contact:{unique:"This e-mail address has already been added."}},errorElement:"span",errorClass:"control-label",errorPlacement:function(){return function(e,t){var n;return n=$(t).parents(".form-group"),n.append(e)}}(this),highlight:function(){return function(e){var t;return t=$(e).parents(".form-group"),t.removeClass("has-success").addClass("has-error")}}(this),success:function(){return function(e,t){var n;return $(t).val(Nlvx.Sanitizers.removeJavascript($(t).val())),n=$(t).parents(".form-group"),n.removeClass("has-error").addClass("has-success")}}(this),submitHandler:function(e){return function(){return e.submitForm()}}(this)})},n.prototype.submitForm=function(){var e,t;return t={},this.$form.serializeArray().map(function(e){return t[e.name]=Nlvx.Sanitizers.removeJavascript(e.value)}),t.index=this.getRowCount()+1,e=$(this.notificationEmailRowTemplate(t)),e.appendTo(this.$table).hide(),this.showRow(e),$.ajax({url:this.$form.attr("action"),type:this.$form.attr("method"),dataType:"json",data:encodeURI(Nlvx.Sanitizers.removeJavascript(unescape(this.$form.serialize()))),success:function(t){return function(n){return e.find(".delete").attr("data-target","/marketing_campaigns/notification_emails/"+n),t.$form.trigger("reset"),t.$modal.modal("hide"),Nlvx.FlashMessageHandler.add("success","Notification recipient successfully added.")}}(this),error:function(t){return function(){return Nlvx.FlashMessageHandler.add("danger","Failed to add your notification recipient."),t.hideRow(e)}}(this)})},n.prototype.hideRow=function(e){return e.fadeOut(this.fadeTime).addClass("removed"),this.$table.trigger("change")},n.prototype.showRow=function(e){return e.fadeIn(this.fadeTime).removeClass("removed"),this.$table.trigger("change")},n.prototype.deleteRow=function(e){return this.hideRow(e),$.ajax({url:e.find(".delete").attr("data-target"),method:"DELETE",dataType:"json",success:function(){return function(){return Nlvx.FlashMessageHandler.add("success","Notification recipient successfully deleted.")}}(this),error:function(t){return function(){return t.showRow(e),Nlvx.FlashMessageHandler.add("danger","Failed to delete your notification recipient.")}}(this)})},n.prototype.onChange=function(){return this.enforceMaxRows(),this.renumberRows()},n.prototype.getEmails=function(){return _.map(this.getRows(),function(e){return $(e).find(".email").text()})},n.prototype.getRows=function(){return this.$table.find(".notification-email-recipient:not(.removed)")},n.prototype.enforceMaxRows=function(){var e;return e=$("[data-target=#"+this.$modal.attr("id")+"]"),this.getRowCount()>=i?e.addClass("btn-secondary").removeClass("btn-primary").attr("disabled",!0):e.removeClass("btn-secondary").addClass("btn-primary").attr("disabled",!1)},n.prototype.getRowCount=function(){return this.getRows().length},n.prototype.renumberRows=function(){return _.each(this.getRows(),function(e,t){return $(e).find(".index").text(t+1)})},n}(),e='<tr class="notification-email-recipient">\n  <td class="index">{{index}}</td>\n  <td class="name">{{contact_label}}</td>\n  <td class="email">{{contact}}</td>\n  <td class="action">\n    <div class="btn btn-small btn-dropdown btn-dropdown-gear dropdown manage-dropdown manage-recipient-dropdown pull-right" data-dropdown-toggle="true">\n      <i class="sg-icon sg-icon-gear"></i>\n      <ul aria-labelledby="dLabel" class="dropdown-menu dropdown-menu-right-aligned" role="menu" data-dropdown-menu="true">\n        <li>\n          <a class="delete dropdown-link dropdown-link-with-icon" data-target="">\n            <i class="sg-icon sg-icon-trash"></i>\n            <span>Delete</span>\n          </a>\n        </li>\n      </ul>\n    </div>\n  </td>\n</tr>'}.call(this);